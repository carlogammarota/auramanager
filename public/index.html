<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title></title>
    <link rel="icon" href="https://auraproducciones.armortemplate.com/logo.png" type="image/png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.2/plyr.css">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
      .plyr__video-embed {
        width: 80%;
        max-width: 800px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/hls.js"></script>
    <script src="https://unpkg.com/plyr@3"></script>
    <script>
  
      document.addEventListener("DOMContentLoaded", () => {
        const video = document.querySelector("video");
        const source = video.getElementsByTagName("source")[0].src;
  
        // For more options see: https://github.com/sampotts/plyr/#options
        // captions.update is required for captions to work with hls.js
        const defaultOptions = {
          autoplay: true,
          muted: true,
          volume: 0.8,
        };
  
        if (Hls.isSupported()) {
          // For more Hls.js options, see https://github.com/dailymotion/hls.js
          const hls = new Hls({
            liveSyncDurationCount: 2,
            liveMaxLatencyDurationCount: 3,
          });
          hls.loadSource(source);
  
          // From the m3u8 playlist, hls parses the manifest and returns
          // all available video qualities. This is important, in this approach,
          // we will have one source on the Plyr player.
          hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
  
            // Transform available levels into an array of integers (height values).
            const availableQualities = hls.levels.map((l) => l.height)
  
            // Add new qualities to option
            defaultOptions.quality = {
              default: availableQualities[0],
              options: availableQualities,
              // this ensures Plyr to use Hls to update quality level
              forced: true,
              onChange: (e) => updateQuality(e),
            }
  
            // Initialize here
            const player = new Plyr(video, defaultOptions);
          });
          hls.attachMedia(video);
          window.hls = hls;
  
          hls.on(Hls.Events.ERROR, function (event, data) {
            if (data.fatal) {
              switch (data.type) {
                case Hls.ErrorTypes.NETWORK_ERROR:
                  console.log("Reconectando...");
                  hls.startLoad();
                  break;
                case Hls.ErrorTypes.MEDIA_ERROR:
                  hls.recoverMediaError();
                  break;
                default:
                  hls.destroy();
                  break;
              }
            }
          });
  
  
        } else {
          // default options with no quality update in case Hls is not supported
          const player = new Plyr(video, defaultOptions);
        }
  
        function updateQuality(newQuality) {
          window.hls.levels.forEach((level, levelIndex) => {
            if (level.height === newQuality) {
              console.log("Found quality match with " + newQuality);
              window.hls.currentLevel = levelIndex;
            }
          });
        }
      });
  
    </script>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
